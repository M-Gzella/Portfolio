"use strict";var menu_items,theme_btn,body,wrapper,hamburger_btn,close_menu_btn,menu_mobile,menu_options_mobile,slide_hover_btns,slider_btn_next,slider_btn_prev,slider,sliders,skill_cards,sections,dots,root,currentSlide=0,startX=null,startY=0,mediaQuery=window.matchMedia("(max-width: 480px)"),main=function(){prepareDOMElements(),prepareDOMEvents(),setTheme()},prepareDOMElements=function(){theme_btn=document.querySelector(".theme_btn"),body=document.querySelector("body"),hamburger_btn=document.querySelector(".hamburger_btn"),close_menu_btn=document.querySelector(".close_menu"),menu_mobile=document.querySelector(".menu_mobile"),menu_options_mobile=document.querySelectorAll(".menu_mobile li"),root=document.documentElement,sections=document.querySelectorAll(".wrapper .section"),dots=document.querySelectorAll(".global_nav ul li a"),menu_items=document.querySelectorAll("a.menu"),slide_hover_btns=document.querySelectorAll(".slide a"),slider_btn_prev=document.querySelector(".prev_btn"),slider_btn_next=document.querySelector(".next_btn"),sliders=document.querySelectorAll(".slide"),slider=document.querySelector(".slider"),wrapper=document.querySelector(".wrapper"),skill_cards=document.querySelectorAll(".skill_card")},prepareDOMEvents=function(){theme_btn.addEventListener("click",changeTheme),hamburger_btn.addEventListener("click",menuHandler),close_menu_btn.addEventListener("click",menuHandler),menu_options_mobile.forEach(function(e){return e.addEventListener("click",menuHandler)}),window.addEventListener("wheel",throttledWheel),wrapper.addEventListener("touchstart",function(e){e=e.touches[0];startY=e.clientY}),wrapper.addEventListener("touchmove",throttledTouch),dots.forEach(function(e){return e.addEventListener("click",dotActiveHandler)}),menu_items.forEach(function(e){return e.addEventListener("click",menuItemActiveHandler)}),slide_hover_btns.forEach(function(e){return e.addEventListener("mouseover",hoverOver)}),slide_hover_btns.forEach(function(e){return e.addEventListener("mouseout",hoverOut)}),slider_btn_next.addEventListener("click",nextSlide),slider_btn_prev.addEventListener("click",prevSlide),slider.addEventListener("touchstart",function(e){startX=e.touches[0].clientX}),slider.addEventListener("touchmove",throttledDeltaX),slider.addEventListener("touchend",function(){startX=null}),mediaQuery.matches&&skill_cards.forEach(function(e){return e.addEventListener("click",throttledSkillCard)})},changeTheme=function(){var e;"light_theme"===body.classList.value?(e=JSON.parse(localStorage.getItem("theme")),body.classList.remove("light_theme"),body.classList.add("dark_theme"),e=body.classList.value,rootColorsDark(),localStorage.setItem("theme",JSON.stringify(e))):"dark_theme"===body.classList.value&&(e=JSON.parse(localStorage.getItem("theme")),body.classList.remove("dark_theme"),body.classList.add("light_theme"),e=body.classList.value,rootColorsLight(),localStorage.setItem("theme",JSON.stringify(e)))},rootColorsLight=function(){root.style.setProperty("--main-theme","#6FDCBF"),root.style.setProperty("--accent-theme","#F6F4F6"),root.style.setProperty("--text-theme","#404040")},rootColorsDark=function(){root.style.setProperty("--main-theme","#774069"),root.style.setProperty("--accent-theme","#29272A"),root.style.setProperty("--text-theme","#FAFAFA")},menuHandler=function(){menu_mobile.classList.toggle("show")},dotActiveHandler=function(e){var t=e.target.getAttribute("href").slice(1);sections.forEach(function(e){e.classList.remove("active"),t===e.id&&e.classList.add("active")}),dots.forEach(function(e){e.classList.remove("active")}),e.target.classList.toggle("active")},checkActiveMenuItems=function(t){sections.forEach(function(e){e.classList.remove("active"),t===e.id&&e.classList.add("active")}),dots.forEach(function(e){e.classList.remove("active"),t===e.getAttribute("href").slice(1)&&e.classList.add("active")})},menuItemActiveHandler=function(e){e=e.target.getAttribute("href").slice(1);checkActiveMenuItems(e)},getCurrentSectionDesktop=function(e){var r,t=sections.length;return sections.forEach(function(e,t){e=e.getBoundingClientRect();e.top<=.5&&.5<=e.bottom&&(r=t)}),{key:e=checkScrollUp(e)?0===r?0:r-1:r===t-1?t-1:r+1,next:sections[e]}};function getCurrentSectionMobile(e){var r,t,e=e.touches[0].clientY-startY,n=sections.length;return sections.forEach(function(e,t){e=e.getBoundingClientRect();e.top<=.5&&.5<=e.bottom&&(r=t)}),20<e?t=0===r?0:r-1:e<-20&&(t=r===n-1?n-1:r+1),{key:t,next:sections[t]}}var sectionActiveHandler=function(t){sections.forEach(function(e){t.id===e.id?e.classList.add("active"):e.classList.remove("active")})},dotScrollActiveHandler=function(r){dots.forEach(function(e,t){r.key===t?e.classList.add("active"):e.classList.remove("active")})},handleActiveSectionDesktop=function(e){var e=getCurrentSectionDesktop(e),t=e.next;sectionActiveHandler(t),dotScrollActiveHandler(e),window.location.hash=t.id,window.scrollTo({behavior:"smooth",top:t.offsetTop})},handleActiveSectionMobile=function(e){var e=getCurrentSectionMobile(e),t=e.next;sectionActiveHandler(t),dotScrollActiveHandler(e),window.location.hash=t.id,window.scrollTo({behavior:"smooth",top:t.offsetTop})},checkScrollUp=function(e){return e.wheelDelta?0<e.wheelDelta:e.deltaY<0},hoverOver=function(e){e.target.closest(".slide").classList.add("hover")},hoverOut=function(e){e.target.closest(".slide").classList.remove("hover")},nextSlide=function(){var e=sliders[currentSlide].offsetWidth;currentSlide<sliders.length-1?(e=(e+20)*++currentSlide,slider.style.transform="translateX(-".concat(e,"px)")):(slider.style.transform="translateX(0)",currentSlide=0)},prevSlide=function(){var e=sliders[currentSlide].offsetWidth,t=parseInt(slider.style.transform.slice(11,-3));0<currentSlide&&(currentSlide--,slider.style.transform="translateX(".concat(t+e+20,"px)"))},checkDeltaX=function(e){null!==startX&&(0<e.touches[0].clientX-startX?prevSlide:nextSlide)()},skillCardHandler=function(e){var t=e.target.getAttribute("data-id"),r=e.target;r.classList.contains("active")?(r.style.transform="translateY(0)",skill_cards.forEach(function(e){e.classList.remove("hide"),e.classList.remove("active")})):(skill_cards.forEach(function(e){e.getAttribute("data-id")===t?r.classList.add("active"):e.classList.add("hide")}),skillCardMoveHandle(t,r))},skillCardMoveHandle=function(e,t){var r=parseInt(t.offsetHeight)+60;switch(e){case"0":setTimeout(function(){t.style.transform="translateY(0)"},300);break;case"1":setTimeout(function(){t.style.transform="translateY(-".concat(r,"px)")},300);break;case"2":setTimeout(function(){t.style.transform="translateY(-".concat(2*r,"px)")},300)}};function throttle(t,r){var n=0;return function(){var e=Date.now();r<=e-n&&(t(event),n=e)}}var throttledWheel=throttle(handleActiveSectionDesktop,500),throttledTouch=throttle(handleActiveSectionMobile,500),throttledDeltaX=throttle(checkDeltaX,500),throttledSkillCard=throttle(skillCardHandler,500),setTheme=function(){var e=JSON.parse(localStorage.getItem("theme"));0===e.length?e=body.classList.value:"dark_theme"===(body.classList.value=e)?rootColorsDark():"light_theme"===e&&rootColorsLight(),localStorage.setItem("theme",JSON.stringify(e))},checkJSON=function(e){try{JSON.parse(e)}catch(e){return!1}return!0};document.addEventListener("DOMContentLoaded",main),window.addEventListener("load",function(e){var t;window.location.href.includes("#")&&(t=window.location.href.split("#")[1],checkActiveMenuItems(t))}),window.addEventListener("DOMContentLoaded",function(){var e;localStorage.getItem("theme")&&0!==(e=localStorage.getItem("theme")).length&&checkJSON(e)&&Array.isArray(JSON.parse(e))||localStorage.setItem("theme",JSON.stringify([])),setTheme()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibWVudV9pdGVtcyIsInRoZW1lX2J0biIsIndyYXBwZXIiLCJoYW1idXJnZXJfYnRuIiwiY2xvc2VfbWVudV9idG4iLCJtZW51X21vYmlsZSIsInNsaWRlX2hvdmVyX2J0bnMiLCJzbGlkZXJfYnRuX25leHQiLCJzbGlkZXJfYnRuX3ByZXYiLCJzbGlkZXIiLCJzbGlkZXJzIiwic2VjdGlvbnMiLCJkb3RzIiwic3RhcnRYIiwic2V0VGhlbWUiLCJjdXJyZW50U2xpZGUiLCJtZWRpYVF1ZXJ5Iiwicm9vdCIsInByZXBhcmVET01FbGVtZW50cyIsIm1hdGNoTWVkaWEiLCJxdWVyeVNlbGVjdG9yIiwiYm9keSIsIm1lbnVfb3B0aW9uc19tb2JpbGUiLCJkb2N1bWVudCIsImRvY3VtZW50RWxlbWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJza2lsbF9jYXJkcyIsInByZXBhcmVET01FdmVudHMiLCJhZGRFdmVudExpc3RlbmVyIiwiY2hhbmdlVGhlbWUiLCJtZW51SGFuZGxlciIsImZvckVhY2giLCJzdGFydFkiLCJlbCIsInRocm90dGxlZFRvdWNoIiwid2luZG93IiwiZG90IiwidGhyb3R0bGVkV2hlZWwiLCJkb3RBY3RpdmVIYW5kbGVyIiwiZXZlbnQiLCJpdGVtIiwidG91Y2giLCJjbGllbnRZIiwiYnRuIiwibWVudUl0ZW1BY3RpdmVIYW5kbGVyIiwiaG92ZXJPdmVyIiwiaG92ZXJPdXQiLCJuZXh0U2xpZGUiLCJ0b3VjaGVzIiwicHJldlNsaWRlIiwidGhyb3R0bGVkRGVsdGFYIiwiY2xpZW50WCIsIm1hdGNoZXMiLCJjYXJkIiwidGhyb3R0bGVkU2tpbGxDYXJkIiwidGhlbWUiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJ2YWx1ZSIsInJvb3RDb2xvcnNEYXJrIiwiSlNPTiIsInN0cmluZ2lmeSIsInNldEl0ZW0iLCJyb290Q29sb3JzTGlnaHQiLCJzdHlsZSIsInNldFByb3BlcnR5IiwidG9nZ2xlIiwic2VjdGlvbiIsImRvdElkIiwidGFyZ2V0IiwiZ2V0QXR0cmlidXRlIiwic2xpY2UiLCJjaGVja0FjdGl2ZU1lbnVJdGVtcyIsImlkIiwiaXRlbUlkIiwiZ2V0Q3VycmVudFNlY3Rpb25EZXNrdG9wIiwiY3VycmVudEtleSIsInJlY3QiLCJrZXkiLCJuZXh0Iiwic2VjdGlvbnNDb3VudCIsImxlbmd0aCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImdldEN1cnJlbnRTZWN0aW9uTW9iaWxlIiwiZGVsdGFZIiwibmV4dEtleSIsInNlY3Rpb25BY3RpdmVIYW5kbGVyIiwiZG90U2Nyb2xsQWN0aXZlSGFuZGxlciIsImJvdHRvbSIsImhhbmRsZUFjdGl2ZVNlY3Rpb25EZXNrdG9wIiwiZGF0YSIsIm5leHRTZWN0aW9uIiwidG9wIiwib2Zmc2V0VG9wIiwid2hlZWxEZWx0YSIsInNsaWRlIiwibG9jYXRpb24iLCJoYXNoIiwiYmVoYXZpb3IiLCJweFRvU2xpZGUiLCJ0cmFuc2Zvcm0iLCJzbGlkZVdpZHRoIiwib2Zmc2V0V2lkdGgiLCJkZWx0YVgiLCJjbG9zZXN0Iiwic2tpbGxDYXJkSGFuZGxlciIsImNhcmRJRCIsImNvbnRhaW5zIiwidGhpc0NhcmQiLCJjb25jYXQiLCJzbGlkZXJUcmFuc2Zvcm0iLCJwYXJzZUludCIsInNraWxsQ2FyZE1vdmVIYW5kbGUiLCJjYXJkSGVpZ2h0Iiwic2V0VGltZW91dCIsImxhc3RDYWxsIiwibm93IiwiZGVsYXkiLCJ0aHJvdHRsZSIsImhhbmRsZUFjdGl2ZVNlY3Rpb25Nb2JpbGUiLCJjaGVja0RlbHRhWCIsIiRpZCIsIiRjYXJkIiwib2Zmc2V0SGVpZ2h0IiwiY2hlY2tKU09OIiwiZnVuYyIsInN0ciIsImUiLCJtYWluIiwidXJsSWQiLCJocmVmIiwiaW5jbHVkZXMiLCJzcGxpdCIsIkFycmF5IiwiaXNBcnJheSJdLCJtYXBwaW5ncyI6ImFBQUEsSUFBSUEsV0FDQUMsVUFEQUQsS0FDQUMsUUFFQUMsY0FFQUMs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IjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgbWVudV9pdGVtcztcclxubGV0IHRoZW1lX2J0bjtcclxubGV0IGJvZHk7XHJcbmxldCB3cmFwcGVyO1xyXG5cclxubGV0IGhhbWJ1cmdlcl9idG47XHJcbmxldCBjbG9zZV9tZW51X2J0bjtcclxubGV0IG1lbnVfbW9iaWxlO1xyXG5sZXQgbWVudV9vcHRpb25zX21vYmlsZTtcclxuXHJcbmxldCBzbGlkZV9ob3Zlcl9idG5zO1xyXG5sZXQgc2xpZGVyX2J0bl9uZXh0O1xyXG5sZXQgc2xpZGVyX2J0bl9wcmV2O1xyXG5sZXQgc2xpZGVyO1xyXG5sZXQgc2xpZGVycztcclxubGV0IGN1cnJlbnRTbGlkZSA9IDA7XHJcblxyXG5sZXQgc2tpbGxfY2FyZHM7XHJcbmxldCBzZWN0aW9ucztcclxubGV0IGRvdHM7XHJcblxyXG5sZXQgc3RhcnRYID0gbnVsbDtcclxubGV0IHN0YXJ0WSA9IDA7XHJcblxyXG5jb25zdCBtZWRpYVF1ZXJ5ID0gd2luZG93Lm1hdGNoTWVkaWEoJyhtYXgtd2lkdGg6IDQ4MHB4KScpO1xyXG5cclxubGV0IHJvb3Q7XHJcblxyXG5jb25zdCBtYWluID0gKCkgPT4ge1xyXG4gICAgcHJlcGFyZURPTUVsZW1lbnRzKCk7XHJcbiAgICBwcmVwYXJlRE9NRXZlbnRzKCk7XHJcbiAgICBzZXRUaGVtZSgpO1xyXG59XHJcblxyXG5jb25zdCBwcmVwYXJlRE9NRWxlbWVudHMgPSAoKSA9PiB7XHJcbiAgICB0aGVtZV9idG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGhlbWVfYnRuJyk7XHJcbiAgICBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xyXG4gICAgaGFtYnVyZ2VyX2J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oYW1idXJnZXJfYnRuJyk7XHJcbiAgICBjbG9zZV9tZW51X2J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jbG9zZV9tZW51Jyk7XHJcbiAgICBtZW51X21vYmlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tZW51X21vYmlsZScpO1xyXG4gICAgbWVudV9vcHRpb25zX21vYmlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tZW51X21vYmlsZSBsaScpO1xyXG4gICAgcm9vdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcclxuICAgIHNlY3Rpb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLndyYXBwZXIgLnNlY3Rpb24nKTtcclxuICAgIGRvdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZ2xvYmFsX25hdiB1bCBsaSBhJyk7XHJcbiAgICBtZW51X2l0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYS5tZW51Jyk7XHJcbiAgICBzbGlkZV9ob3Zlcl9idG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNsaWRlIGEnKTtcclxuICAgIHNsaWRlcl9idG5fcHJldiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcmV2X2J0bicpO1xyXG4gICAgc2xpZGVyX2J0bl9uZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5leHRfYnRuJyk7XHJcbiAgICBzbGlkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNsaWRlJyk7XHJcbiAgICBzbGlkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2xpZGVyJyk7XHJcbiAgICB3cmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndyYXBwZXInKTtcclxuICAgIHNraWxsX2NhcmRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNraWxsX2NhcmQnKTtcclxufVxyXG5cclxuXHJcbmNvbnN0IHByZXBhcmVET01FdmVudHMgPSAoKSA9PiB7XHJcbiAgICB0aGVtZV9idG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjaGFuZ2VUaGVtZSk7XHJcbiAgICBoYW1idXJnZXJfYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbWVudUhhbmRsZXIpO1xyXG4gICAgY2xvc2VfbWVudV9idG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtZW51SGFuZGxlcik7XHJcbiAgICBtZW51X29wdGlvbnNfbW9iaWxlLmZvckVhY2goZWwgPT4gZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtZW51SGFuZGxlcikpO1xyXG5cclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIHRocm90dGxlZFdoZWVsKTtcclxuXHJcbiAgICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCB0b3VjaCA9IGV2ZW50LnRvdWNoZXNbMF07XHJcbiAgICAgICAgc3RhcnRZID0gdG91Y2guY2xpZW50WTtcclxuICAgIH0pXHJcbiAgICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRocm90dGxlZFRvdWNoKTtcclxuXHJcbiAgICBkb3RzLmZvckVhY2goZG90ID0+IGRvdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGRvdEFjdGl2ZUhhbmRsZXIpKTtcclxuICAgIG1lbnVfaXRlbXMuZm9yRWFjaChpdGVtID0+IGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtZW51SXRlbUFjdGl2ZUhhbmRsZXIpKVxyXG5cclxuICAgIHNsaWRlX2hvdmVyX2J0bnMuZm9yRWFjaChidG4gPT4gYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIGhvdmVyT3ZlcikpO1xyXG4gICAgc2xpZGVfaG92ZXJfYnRucy5mb3JFYWNoKGJ0biA9PiBidG4uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCBob3Zlck91dCkpO1xyXG4gICAgc2xpZGVyX2J0bl9uZXh0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbmV4dFNsaWRlKTtcclxuICAgIHNsaWRlcl9idG5fcHJldi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHByZXZTbGlkZSk7XHJcblxyXG4gICAgc2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICBzdGFydFggPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFg7XHJcbiAgICB9KVxyXG4gICAgc2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRocm90dGxlZERlbHRhWCk7XHJcbiAgICBzbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCAoKSA9PiB7XHJcbiAgICAgICAgc3RhcnRYID0gbnVsbDtcclxuICAgIH0pXHJcblxyXG4gICAgaWYgKG1lZGlhUXVlcnkubWF0Y2hlcykge1xyXG4gICAgICAgIHNraWxsX2NhcmRzLmZvckVhY2goY2FyZCA9PiBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhyb3R0bGVkU2tpbGxDYXJkKSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vIEZ1bmtjamEgem1pZW5pYSB0aGVtZSBzdHJvbnkgemEgcG9tb2PEhSBrbGFzeSBsaWdodF90aGVtZSBvcmF6IGRhcmtfdGhlbWUsIGt0w7NyZVxyXG4vLyBkb2RhamUgZG8gYm9keS4gWm1pZW5pYSB0ZcW8IGtvbG9yeSB3IHJvb3Qgb3JheiBkb2RhamUgYWt0dWFsbnkgdGhlbWUgZG9cclxuLy8gbG9jYWxzdG9yYWdlXHJcbmNvbnN0IGNoYW5nZVRoZW1lID0gKCkgPT4ge1xyXG4gICAgaWYgKGJvZHkuY2xhc3NMaXN0LnZhbHVlID09PSAnbGlnaHRfdGhlbWUnKSB7XHJcbiAgICAgICAgbGV0IHRoZW1lID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndGhlbWUnKSk7XHJcbiAgICAgICAgYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdsaWdodF90aGVtZScpO1xyXG4gICAgICAgIGJvZHkuY2xhc3NMaXN0LmFkZCgnZGFya190aGVtZScpO1xyXG5cclxuICAgICAgICB0aGVtZSA9IGJvZHkuY2xhc3NMaXN0LnZhbHVlO1xyXG5cclxuXHJcbiAgICAgICAgcm9vdENvbG9yc0RhcmsoKTtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGhlbWUnLCBKU09OLnN0cmluZ2lmeSh0aGVtZSkpO1xyXG5cclxuICAgIH0gZWxzZSBpZiAoYm9keS5jbGFzc0xpc3QudmFsdWUgPT09ICdkYXJrX3RoZW1lJykge1xyXG4gICAgICAgIGxldCB0aGVtZSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3RoZW1lJykpXHJcbiAgICAgICAgYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdkYXJrX3RoZW1lJyk7XHJcbiAgICAgICAgYm9keS5jbGFzc0xpc3QuYWRkKCdsaWdodF90aGVtZScpO1xyXG5cclxuICAgICAgICB0aGVtZSA9IGJvZHkuY2xhc3NMaXN0LnZhbHVlO1xyXG5cclxuICAgICAgICByb290Q29sb3JzTGlnaHQoKTtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGhlbWUnLCBKU09OLnN0cmluZ2lmeSh0aGVtZSkpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCByb290Q29sb3JzTGlnaHQgPSAoKSA9PiB7XHJcbiAgICByb290LnN0eWxlLnNldFByb3BlcnR5KCctLW1haW4tdGhlbWUnLCAnIzZGRENCRicpO1xyXG4gICAgcm9vdC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1hY2NlbnQtdGhlbWUnLCAnI0Y2RjRGNicpO1xyXG4gICAgcm9vdC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS10ZXh0LXRoZW1lJywgJyM0MDQwNDAnKTtcclxufVxyXG5cclxuY29uc3Qgcm9vdENvbG9yc0RhcmsgPSAoKSA9PiB7XHJcbiAgICByb290LnN0eWxlLnNldFByb3BlcnR5KCctLW1haW4tdGhlbWUnLCAnIzc3NDA2OScpO1xyXG4gICAgcm9vdC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1hY2NlbnQtdGhlbWUnLCAnIzI5MjcyQScpO1xyXG4gICAgcm9vdC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS10ZXh0LXRoZW1lJywgJyNGQUZBRkEnKTtcclxufVxyXG5cclxuY29uc3QgbWVudUhhbmRsZXIgPSAoKSA9PiB7XHJcbiAgICBtZW51X21vYmlsZS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XHJcbn1cclxuXHJcbi8vRnVuY2tqYSBvZHBhbGEgc2nEmSBwbyBrbGlrbmnEmWNpdSB3IGRvdGEgaSBwb2JpZXJhIGRhdGEgYXRyeWJ1dC5cclxuLy9OYXN0xJlwbmllIHByemVjaG9kemkgcG8ga2HFvGR5bSBkb3RjaWUgaSB1c3V3YSBtdSBrbGFzxJkgYWN0aXZlIGlcclxuLy9zcHJhd2R6YSBrdMOzcnkgZG90IHcgZm9yZWFjaHUgcsOzd25hIHNpxJkgdGVtdSB3IGt0w7NyeSBrbGlrbmnEmXRvIGlcclxuLy9kb2RhamUgbXUga2xhc8SZIGFjdGl2ZSwgdGFrYSBzYW1hIGxvZ2lrYSBqZXN0IHByenkgZG9kYXdhbml1IGtsYXN5IGFjdGl2ZVxyXG4vL2RvIHNla2NqaS5cclxuY29uc3QgZG90QWN0aXZlSGFuZGxlciA9IChldmVudCkgPT4ge1xyXG4gICAgY29uc3QgZG90SWQgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJykuc2xpY2UoMSlcclxuICAgIHNlY3Rpb25zLmZvckVhY2goc2VjdGlvbiA9PiB7XHJcbiAgICAgICAgc2VjdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgICAgICBpZiAoZG90SWQgPT09IHNlY3Rpb24uaWQpIHtcclxuICAgICAgICAgICAgc2VjdGlvbi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgZG90cy5mb3JFYWNoKGRvdCA9PiB7XHJcbiAgICAgICAgZG90LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgfSlcclxuICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTtcclxufVxyXG5cclxuXHJcbmNvbnN0IGNoZWNrQWN0aXZlTWVudUl0ZW1zID0gKGlkKSA9PiB7XHJcbiAgICBzZWN0aW9ucy5mb3JFYWNoKHNlY3Rpb24gPT4ge1xyXG4gICAgICAgIHNlY3Rpb24uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICAgICAgaWYgKGlkID09PSBzZWN0aW9uLmlkKSB7XHJcbiAgICAgICAgICAgIHNlY3Rpb24uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBkb3RzLmZvckVhY2goZG90ID0+IHtcclxuICAgICAgICBkb3QuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICAgICAgaWYgKGlkID09PSBkb3QuZ2V0QXR0cmlidXRlKCdocmVmJykuc2xpY2UoMSkpIHtcclxuICAgICAgICAgICAgZG90LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn1cclxuY29uc3QgbWVudUl0ZW1BY3RpdmVIYW5kbGVyID0gKGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCBpdGVtSWQgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJykuc2xpY2UoMSk7XHJcblxyXG4gICAgY2hlY2tBY3RpdmVNZW51SXRlbXMoaXRlbUlkKTtcclxufVxyXG5cclxuXHJcbi8vRnVua2NqYSB3eXdvxYJhbmEgdcW8eWNpZW0gc2Nyb2xsYSwgZm9yZWFjaCBwcnplY2hvZHppIHBvIHdzenlzdGtpY2ggc2VrY2phY2ggaSBzcHJhd2R6YSBjenkgZGFuYSBzZWtjamFcclxuLy9qZXN0IHdpZG9jem5hIG5hIHN0cm9uaWUsIGplemVsaSB0YWsgdG8gZG9kYWplIGRvIGN1cnJlbnRrZXkgaW5kZWtzIHNla2NqaSB6IHRhYmxpY3kuXHJcbi8vTmFzdMSZcG5pZSBmdW5ja2phIGNoZWNrU2Nyb2xsVXAgc3ByYXdkemEgY3p5IHpvc3RhxYIgdcW8eXR5IHNjcm9sbCB3IGfDs3JlIGN6eSB3IGTDs8WCIGkgb2Rwb3dpZWRuaW9cclxuLy96bWllbmlhIGN1cnJlbnRrZXkgdyBnw7NyZSBsdWIgdyBkw7PFgiwgYWJ5IHV6eXNrYcSHIHNla2NqZSwga3TDs3JhIG1hIHNpxJkgcG9rYXphxIcuXHJcbmNvbnN0IGdldEN1cnJlbnRTZWN0aW9uRGVza3RvcCA9IChldmVudCkgPT4ge1xyXG4gICAgbGV0IGN1cnJlbnRLZXksIG5leHRLZXk7XHJcbiAgICBsZXQgc2VjdGlvbnNDb3VudCA9IHNlY3Rpb25zLmxlbmd0aDtcclxuXHJcbiAgICBzZWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChzZWN0aW9uLCBrZXkpIHtcclxuICAgICAgICBjb25zdCByZWN0ID0gc2VjdGlvbi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgICAgICAgaWYgKHJlY3QudG9wIDw9IDAuNSAmJiByZWN0LmJvdHRvbSA+PSAwLjUpIHtcclxuICAgICAgICAgICAgY3VycmVudEtleSA9IGtleTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoY2hlY2tTY3JvbGxVcChldmVudCkpIHtcclxuICAgICAgICBuZXh0S2V5ID0gKGN1cnJlbnRLZXkgPT09IDApID8gMCA6IGN1cnJlbnRLZXkgLSAxO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBuZXh0S2V5ID0gKGN1cnJlbnRLZXkgPT09IHNlY3Rpb25zQ291bnQgLSAxKSA/IHNlY3Rpb25zQ291bnQgLSAxIDogY3VycmVudEtleSArIDE7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBrZXk6IG5leHRLZXksXHJcbiAgICAgICAgbmV4dDogc2VjdGlvbnNbbmV4dEtleV0sXHJcbiAgICB9XHJcbn1cclxuXHJcbi8vRnVua2NqYSBkemlhxYJhIG5hIHRlaiBzYW1laiB6YXNhZHppZSBjbyB3ecW8ZWogeiB0eW0gxbxlIHNwcmF3ZHphbmUgamVzdCBkb3RrbmnEmWNpZSB1cnrEhWR6ZW5pYSxcclxuLy9hIG5pZSBzY3JvbGwuIFByemVzdW5pxJljaWUgcGFsY2VtIHcgZ8OzcmUgbHViIHcgZMOzxYIgbXVzaSBiecSHIHdpxJlrc3plL21uaWVqc3plIG5pxbwgMjBweCAoYWJ5XHJcbi8vc2xpZGVyIGR6aWHFgmHFgiBwb3ByYXduaWUpXHJcbmZ1bmN0aW9uIGdldEN1cnJlbnRTZWN0aW9uTW9iaWxlKGV2ZW50KSB7XHJcbiAgICBjb25zdCB0b3VjaCA9IGV2ZW50LnRvdWNoZXNbMF07XHJcbiAgICBjb25zdCBkZWx0YVkgPSB0b3VjaC5jbGllbnRZIC0gc3RhcnRZO1xyXG5cclxuICAgIGxldCBjdXJyZW50S2V5LCBuZXh0S2V5O1xyXG4gICAgbGV0IHNlY3Rpb25zQ291bnQgPSBzZWN0aW9ucy5sZW5ndGg7XHJcblxyXG4gICAgc2VjdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoc2VjdGlvbiwga2V5KSB7XHJcbiAgICAgICAgY29uc3QgcmVjdCA9IHNlY3Rpb24uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcblxyXG4gICAgICAgIGlmIChyZWN0LnRvcCA8PSAwLjUgJiYgcmVjdC5ib3R0b20gPj0gMC41KSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRLZXkgPSBrZXk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGRlbHRhWSA+IDIwKSB7XHJcbiAgICAgICAgbmV4dEtleSA9IChjdXJyZW50S2V5ID09PSAwKSA/IDAgOiBjdXJyZW50S2V5IC0gMTtcclxuICAgIH0gZWxzZSBpZiAoZGVsdGFZIDwgLTIwKSB7XHJcbiAgICAgICAgbmV4dEtleSA9IChjdXJyZW50S2V5ID09PSBzZWN0aW9uc0NvdW50IC0gMSkgPyBzZWN0aW9uc0NvdW50IC0gMSA6IGN1cnJlbnRLZXkgKyAxO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAga2V5OiBuZXh0S2V5LFxyXG4gICAgICAgIG5leHQ6IHNlY3Rpb25zW25leHRLZXldLFxyXG4gICAgfVxyXG59XHJcblxyXG5cclxuY29uc3Qgc2VjdGlvbkFjdGl2ZUhhbmRsZXIgPSAobmV4dFNlY3Rpb24pID0+IHtcclxuXHJcbiAgICBzZWN0aW9ucy5mb3JFYWNoKHNlY3Rpb24gPT4ge1xyXG4gICAgICAgIGlmIChuZXh0U2VjdGlvbi5pZCA9PT0gc2VjdGlvbi5pZCkge1xyXG4gICAgICAgICAgICBzZWN0aW9uLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNlY3Rpb24uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxufVxyXG5cclxuY29uc3QgZG90U2Nyb2xsQWN0aXZlSGFuZGxlciA9IChkYXRhKSA9PiB7XHJcblxyXG4gICAgZG90cy5mb3JFYWNoKGZ1bmN0aW9uIChkb3QsIGtleSkge1xyXG4gICAgICAgIGlmIChkYXRhLmtleSA9PT0ga2V5KSB7XHJcbiAgICAgICAgICAgIGRvdC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkb3QuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxufVxyXG5cclxuLy9GdW5ja2phIHBvYmllcmEgaW5mb3JtYWNqZSBvIG5hc3TEmXBuZWogc2VrY2ppLCBhIG5hc3TEmXBuaWUgcHJ6ZXN1d2Egc2nEmSBvZHBvd2llZG5pbyBuYVxyXG4vL2plaiB3eXNva2/Fm8SHIGkgZG9kYWplIGRvIFVSTCBpZCBzZWtjamkuXHJcbmNvbnN0IGhhbmRsZUFjdGl2ZVNlY3Rpb25EZXNrdG9wID0gKGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCBkYXRhID0gZ2V0Q3VycmVudFNlY3Rpb25EZXNrdG9wKGV2ZW50KTtcclxuICAgIGNvbnN0IG5leHRTZWN0aW9uID0gZGF0YS5uZXh0O1xyXG5cclxuICAgIHNlY3Rpb25BY3RpdmVIYW5kbGVyKG5leHRTZWN0aW9uKTtcclxuICAgIGRvdFNjcm9sbEFjdGl2ZUhhbmRsZXIoZGF0YSk7XHJcblxyXG4gICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBuZXh0U2VjdGlvbi5pZDtcclxuXHJcbiAgICB3aW5kb3cuc2Nyb2xsVG8oe2JlaGF2aW9yOiBcInNtb290aFwiLCB0b3A6IG5leHRTZWN0aW9uLm9mZnNldFRvcH0pO1xyXG59XHJcblxyXG5jb25zdCBoYW5kbGVBY3RpdmVTZWN0aW9uTW9iaWxlID0gKGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCBkYXRhID0gZ2V0Q3VycmVudFNlY3Rpb25Nb2JpbGUoZXZlbnQpO1xyXG4gICAgY29uc3QgbmV4dFNlY3Rpb24gPSBkYXRhLm5leHQ7XHJcblxyXG4gICAgc2VjdGlvbkFjdGl2ZUhhbmRsZXIobmV4dFNlY3Rpb24pO1xyXG4gICAgZG90U2Nyb2xsQWN0aXZlSGFuZGxlcihkYXRhKTtcclxuXHJcbiAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IG5leHRTZWN0aW9uLmlkO1xyXG5cclxuICAgIHdpbmRvdy5zY3JvbGxUbyh7YmVoYXZpb3I6IFwic21vb3RoXCIsIHRvcDogbmV4dFNlY3Rpb24ub2Zmc2V0VG9wfSk7XHJcbn1cclxuXHJcbmNvbnN0IGNoZWNrU2Nyb2xsVXAgPSAoZXZlbnQpID0+IHtcclxuICAgIGlmIChldmVudC53aGVlbERlbHRhKSB7XHJcbiAgICAgICAgcmV0dXJuIGV2ZW50LndoZWVsRGVsdGEgPiAwO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGV2ZW50LmRlbHRhWSA8IDA7XHJcbn1cclxuY29uc3QgaG92ZXJPdmVyID0gKGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCBzbGlkZSA9IGV2ZW50LnRhcmdldC5jbG9zZXN0KCcuc2xpZGUnKTtcclxuXHJcbiAgICBzbGlkZS5jbGFzc0xpc3QuYWRkKCdob3ZlcicpO1xyXG59XHJcblxyXG5jb25zdCBob3Zlck91dCA9IChldmVudCkgPT4ge1xyXG4gICAgY29uc3Qgc2xpZGUgPSBldmVudC50YXJnZXQuY2xvc2VzdCgnLnNsaWRlJyk7XHJcblxyXG4gICAgc2xpZGUuY2xhc3NMaXN0LnJlbW92ZSgnaG92ZXInKTtcclxufVxyXG5cclxuXHJcbi8vRnVuY2tqZSBkbyBwcnplc3V3YW5pYSBzbGlkZXJhLCBwb2JpZXJhasSFIGFrdHVhbG7EhSBzemVyb2tvxZvEhyBzbGFqZHUsXHJcbi8vYSBuYXN0xJlwbmllIG9kcG93aWVkbmlvIHByemVzdXdhasSFIHNsaWRlciB3IHByYXdvL2xld28gbyBzemVyb2tvxZvEhyBzbGFqZHUuXHJcbmNvbnN0IG5leHRTbGlkZSA9ICgpID0+IHtcclxuICAgIGNvbnN0IHNsaWRlV2lkdGggPSBzbGlkZXJzW2N1cnJlbnRTbGlkZV0ub2Zmc2V0V2lkdGhcclxuICAgIGlmIChjdXJyZW50U2xpZGUgPCBzbGlkZXJzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICBjdXJyZW50U2xpZGUrKztcclxuICAgICAgICBjb25zdCBweFRvU2xpZGUgPSAoc2xpZGVXaWR0aCArIDIwKSAqIGN1cnJlbnRTbGlkZTtcclxuICAgICAgICBzbGlkZXIuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoLSR7cHhUb1NsaWRlfXB4KWA7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHNsaWRlci5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWCgwKWA7XHJcbiAgICAgICAgY3VycmVudFNsaWRlID0gMDtcclxuICAgIH1cclxufVxyXG5cclxuY29uc3QgcHJldlNsaWRlID0gKCkgPT4ge1xyXG4gICAgY29uc3Qgc2xpZGVXaWR0aCA9IHNsaWRlcnNbY3VycmVudFNsaWRlXS5vZmZzZXRXaWR0aDtcclxuICAgIGNvbnN0IHNsaWRlclRyYW5zZm9ybSA9IHBhcnNlSW50KHNsaWRlci5zdHlsZS50cmFuc2Zvcm0uc2xpY2UoMTEsIC0zKSk7XHJcbiAgICBpZiAoY3VycmVudFNsaWRlID4gMCkge1xyXG4gICAgICAgIGN1cnJlbnRTbGlkZS0tO1xyXG4gICAgICAgIGNvbnN0IHB4VG9TbGlkZSA9IChzbGlkZXJUcmFuc2Zvcm0gKyBzbGlkZVdpZHRoICsgMjApO1xyXG4gICAgICAgIHNsaWRlci5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWCgke3B4VG9TbGlkZX1weClgO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBjaGVja0RlbHRhWCA9IChldmVudCkgPT4ge1xyXG4gICAgaWYgKHN0YXJ0WCAhPT0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRYID0gZXZlbnQudG91Y2hlc1swXS5jbGllbnRYO1xyXG4gICAgICAgIGNvbnN0IGRlbHRhWCA9IGN1cnJlbnRYIC0gc3RhcnRYO1xyXG5cclxuICAgICAgICBpZiAoZGVsdGFYID4gMCkge1xyXG4gICAgICAgICAgICBwcmV2U2xpZGUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBuZXh0U2xpZGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vRnVuY2tqYSBkbyBha3R5d293YW5pYSBrYXJ0eSB6IHVtaWVqxJl0bm/Fm2NpYW1pIHcgd2Vyc2ppIG1vYmlsbmVqLlxyXG4vL1BvYmllcmEgZGFuZSBrYXJ0eSBpIHNwcmF3ZHphIGN6eSBwb3NpYWRhIGtsYXPEmSBhY3RpdmUsIGplxbxlbGkgdGFrXHJcbi8vdG8ga2FydGEgd3JhY2EgbmEgbWllanNjZSBpIHVzdXdhbmUgc8SFIGtsYXN5IHoga2FydHkuXHJcbi8vSmXFvGVsaSBuaWUgbWEgdG8gZG9kYWplIGFjdGl2ZSB0byBrbGlrbmnEmXRlaiBrYXJ0eSwgYSByZXN6dGEgb3RyenltdWplIGtsYXPEmVxyXG4vL2hpZGUsIGEgbmFzdMSZcG5pZSBmdW5rY2phIHNraWxsQ2FyZE1vdmVIYW5kbGUgcHJ6ZXN1d2Egb2Rwb3dpZWRuaW8ga2FydMSZLlxyXG5jb25zdCBza2lsbENhcmRIYW5kbGVyID0gKGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCBjYXJkSUQgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XHJcbiAgICBjb25zdCB0aGlzQ2FyZCA9IGV2ZW50LnRhcmdldDtcclxuXHJcbiAgICBpZiAodGhpc0NhcmQuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkge1xyXG4gICAgICAgIHRoaXNDYXJkLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKDApJztcclxuXHJcbiAgICAgICAgc2tpbGxfY2FyZHMuZm9yRWFjaChjYXJkID0+IHtcclxuICAgICAgICAgICAgY2FyZC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XHJcbiAgICAgICAgICAgIGNhcmQuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHNraWxsX2NhcmRzLmZvckVhY2goY2FyZCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjYXJkLmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpID09PSBjYXJkSUQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXNDYXJkLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBza2lsbENhcmRNb3ZlSGFuZGxlKGNhcmRJRCwgdGhpc0NhcmQpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBza2lsbENhcmRNb3ZlSGFuZGxlID0gKCRpZCwgJGNhcmQpID0+IHtcclxuICAgIGNvbnN0IGNhcmRIZWlnaHQgPSBwYXJzZUludCgkY2FyZC5vZmZzZXRIZWlnaHQpICsgNjA7XHJcbiAgICBzd2l0Y2ggKCRpZCkge1xyXG4gICAgICAgIGNhc2UgJzAnOlxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICRjYXJkLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKDApJztcclxuICAgICAgICAgICAgfSwgMzAwKVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICcxJzpcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAkY2FyZC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWSgtJHtjYXJkSGVpZ2h0fXB4KWA7XHJcbiAgICAgICAgICAgIH0sIDMwMClcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnMic6XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgJGNhcmQuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVkoLSR7KGNhcmRIZWlnaHQpKjJ9cHgpYDtcclxuICAgICAgICAgICAgfSwgMzAwKVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxufVxyXG5cclxuLy9GdW5rY2phIGRvIG9ncmFuaWN6YW5pYSB3eWtvbnl3YW5pYSBzacSZIGZ1bmtjamlcclxuZnVuY3Rpb24gdGhyb3R0bGUoZnVuYywgZGVsYXkpIHtcclxuICAgIGxldCBsYXN0Q2FsbCA9IDA7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICAgICAgaWYgKG5vdyAtIGxhc3RDYWxsID49IGRlbGF5KSB7XHJcbiAgICAgICAgICAgIGZ1bmMoZXZlbnQpO1xyXG4gICAgICAgICAgICBsYXN0Q2FsbCA9IG5vdztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IHRocm90dGxlZFdoZWVsID0gdGhyb3R0bGUoaGFuZGxlQWN0aXZlU2VjdGlvbkRlc2t0b3AsIDUwMCk7XHJcbmNvbnN0IHRocm90dGxlZFRvdWNoID0gdGhyb3R0bGUoaGFuZGxlQWN0aXZlU2VjdGlvbk1vYmlsZSwgNTAwKTtcclxuY29uc3QgdGhyb3R0bGVkRGVsdGFYID0gdGhyb3R0bGUoY2hlY2tEZWx0YVgsIDUwMCk7XHJcbmNvbnN0IHRocm90dGxlZFNraWxsQ2FyZCA9IHRocm90dGxlKHNraWxsQ2FyZEhhbmRsZXIsIDUwMCk7XHJcblxyXG5jb25zdCBzZXRUaGVtZSA9ICgpID0+IHtcclxuICAgIGxldCB0aGVtZSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3RoZW1lJykpO1xyXG5cclxuICAgIGlmICh0aGVtZS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICB0aGVtZSA9IGJvZHkuY2xhc3NMaXN0LnZhbHVlO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0aGVtZScsIEpTT04uc3RyaW5naWZ5KHRoZW1lKSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGJvZHkuY2xhc3NMaXN0LnZhbHVlID0gdGhlbWU7XHJcbiAgICAgICAgaWYgKHRoZW1lID09PSAnZGFya190aGVtZScpIHtcclxuICAgICAgICAgICAgcm9vdENvbG9yc0RhcmsoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoZW1lID09PSdsaWdodF90aGVtZScpIHtcclxuICAgICAgICAgICAgcm9vdENvbG9yc0xpZ2h0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0aGVtZScsIEpTT04uc3RyaW5naWZ5KHRoZW1lKSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IGNoZWNrSlNPTiA9IChzdHIpID0+IHtcclxuICAgIHRyeXtcclxuICAgICAgICBKU09OLnBhcnNlKHN0cik7XHJcbiAgICB9Y2F0Y2goZSl7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBtYWluKTtcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoZXZlbnQpID0+IHtcclxuICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5pbmNsdWRlcyhcIiNcIikpIHtcclxuICAgICAgICBjb25zdCBzcGxpdElkID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJyMnKTtcclxuICAgICAgICBjb25zdCB1cmxJZCA9IHNwbGl0SWRbMV07XHJcbiAgICAgICAgY2hlY2tBY3RpdmVNZW51SXRlbXModXJsSWQpO1xyXG4gICAgfVxyXG59KVxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpPT57XHJcbiAgICBpZihsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndGhlbWUnKSl7XHJcbiAgICAgICAgbGV0IHRoZW1lID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3RoZW1lJyk7XHJcbiAgICAgICAgaWYodGhlbWUubGVuZ3RoID09PSAwKXtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3RoZW1lJywgSlNPTi5zdHJpbmdpZnkoW10pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighY2hlY2tKU09OKHRoZW1lKSl7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0aGVtZScsIEpTT04uc3RyaW5naWZ5KFtdKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYoIUFycmF5LmlzQXJyYXkoSlNPTi5wYXJzZSh0aGVtZSkpKXtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3RoZW1lJywgSlNPTi5zdHJpbmdpZnkoW10pKTtcclxuICAgICAgICB9XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGhlbWUnLCBKU09OLnN0cmluZ2lmeShbXSkpO1xyXG4gICAgfVxyXG4gICAgc2V0VGhlbWUoKTtcclxufSlcclxuIl19
